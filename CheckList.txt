## **MVP Roadmap: "FireSafe Estate Assistant - Phase 1"**

**Цель MVP:** Рабочий десктоп-прототип с реальной базой данных, который показывает помещения/датчики и позволяет задавать вопросы о них через локального ИИ.

---

### **Этап 0: Подготовка и инфраструктура**
**Цель:** Получить готовое к работе окружение.
- [ ] **Чеклист:**
    - [ ] **На сервере PostgreSQL:** Создать пользователя и базу данных (`fire_safe_db`). Зафиксировать хост, порт, логин, пароль.
    - [ ] **На рабочей машине (с RTX 5090):** Установить Miniconda/Anaconda.
    - [ ] Создать изолированное conda-окружение: `conda create -n firesafe python=3.11`.
    - [ ] Активировать окружение: `conda activate firesafe`.
    - [ ] Установить базовые инструменты: `pip install jupyter notebook` для экспериментов.

---

### **Этап 1: База данных и ядро данных (Data Layer)**
**Цель:** Иметь структурированное хранилище с тестовыми данными.
- [ ] **Чеклист:**
    - [ ] **Спроектировать и создать MVP-схему БД (5-6 таблиц):**
        1.  `buildings` (id, name)
        2.  `floors` (id, building_id, number)
        3.  `rooms` (id, floor_id, number, type, square)
        4.  `tenants` (id, name, contact)
        5.  `sensors` (id, room_id, type, current_status*, serial)
        6.  `contracts` (id, tenant_id, room_id, start_date) *или просто поле `tenant_id` в `rooms` для MVP.
        *(`current_status` - просто текстовое поле: `'ok'`, `'fault'`, `'check'`)
    - [ ] Написать SQL-скрипт создания схемы (`schema.sql`) и наполнения тестовыми данными (`fixtures.sql`). **Важно:** Создать хотя бы 2 корпуса, 3-4 этажа, 10-15 помещений, 3-4 арендатора, 20-30 датчиков.
    - [ ] Выполнить скрипты на сервере БД.
    - [ ] **В Python-проекте:** Создать модуль `database/` с конфигурацией подключения.
    - [ ] Проверить подключение, написать простой скрипт, который делает `SELECT * FROM rooms;` и выводит результат.

---

### **Этап 2: Локальный ИИ-ассистент (AI Layer)**
**Цель:** Запустить локальную модель, которая понимает контекст проекта и умеет отвечать на вопросы, анализируя БД.
- [ ] **Чеклист:**
    - [ ] **Выбор модели:** Для MVP взять относительно легкую, но способную модель, например, **Qwen2.5-7B-Instruct** или **Llama 3.2 3B**. Она идеально впишется в 24GB памяти RTX 5090.
    - [ ] **Установка фреймворка:** Установить `ollama` (самый простой путь) ИЛИ `llama-cpp-python` (больше контроля).
    - [ ] **Скачать и запустить модель:** Запустить модель в фоновом режиме как сервис (например, `ollama serve`). Убедиться, что она отвечает на базовые вопросы через API (`http://localhost:11434` для Ollama).
    - [ ] **Создание "мозга" ассистента:** Написать модуль `assistant/core.py`. Его задачи:
        1.  Принимать текстовый запрос пользователя.
        2.  **Анализировать намерение:** Определять, спрашивает ли пользователь о *данных* (где что находится, какой статус) или хочет *действия* (сменить статус - это оставим на потом).
        3.  **Генерировать SQL-запрос:** На основе намерения и сущностей (извлеченных LLM) формировать корректный SQL для получения ответа из БД. **Это ключевая и самая сложная часть MVP.**
        4.  **Выполнять запрос к БД** через модуль из Этапа 1.
        5.  **Формировать ответ:** Передавать сырые данные из БД обратно в LLM с просьбой оформить их в красивый, краткий текст для пользователя.
        6.  Возвращать этот текст.
    - [ ] **Создать промпт-инструкцию** для LLM, которая описывает схему БД и правила игры: "Ты — ассистент по управлению зданиями. У тебя есть доступ к БД со следующими таблицами... Твоя задача — понять вопрос и вернуть ТОЛЬКО SQL-запрос для его выполнения. Не объясняй ничего."

---

### **Этап 3: Минимальное десктопное приложение (UI Layer)**
**Цель:** Визуальный интерфейс, объединяющий всё воедино.
- [ ] **Чеклист:**
    - [ ] **Выбор GUI-фреймворка:** Для скорости и простоты в Python — **CustomTkinter**. Он современный и стильный. Установить: `pip install customtkinter`.
    - [ ] **Спроектировать главное окно (3 панели):**
        1.  **Левая панель (Навигация):** Дерево или список для просмотра структуры: Корпус -> Этаж -> Помещение. При клике — загрузка деталей в центральную панель.
        2.  **Центральная панель (Детали):**
            - Табличка с информацией о выбранном объекте (название, тип, площадь).
            - Если выбрано помещение — список датчиков в нем с их статусом (цветные индикаторы: зеленый/красный/желтый).
            - Кнопка "Изменить статус датчика" (простой выпадающий список + кнопка "Сохранить").
        3.  **Правая панель (Чат с ИИ):**
            - Текстовое поле истории диалога.
            - Поле ввода текста.
            - Кнопка "Отправить". Отправляет запрос модулю из Этапа 2 и выводит ответ.
    - [ ] **Реализовать логику:**
        - [ ] Загрузка древовидной структуры из БД в левую панель.
        - [ ] Отображение деталей при выборе элемента.
        - [ ] Обработка кнопки смены статуса датчика (прямое обновление в БД).
        - [ ] Интеграция чата: отправка вопроса в `assistant/core.py` и отображение ответа.
    - [ ] **Добавить "голосовую фишку" (опционально, но сильно "заходит"):**
        - [ ] Кнопка микрофона в чате.
        - [ ] Использовать библиотеку `speech_recognition` для записи голоса и конвертации в текст (он пойдет в поле ввода).
        - [ ] Использовать `pyttsx3` для озвучки ответов ИИ (по другой кнопке).

---

### **Этап 4: Интеграция, тестирование и упаковка**
**Цель:** Получить цельный, запускаемый продукт.
- [ ] **Чеклист:**
    - [ ] **Интеграционное тестирование:** Пройти главные сценарии MVP:
        1.  Запустить приложение. Увидеть дерево зданий.
        2.  Выбрать помещение. Увидеть список датчиков.
        3.  Сменить статус одного датчика. Обновить список (статус должен измениться).
        4.  В чате спросить: *"Покажи все неисправные датчики в корпусе 'Альфа'"*. Получить вменяемый ответ с перечнем.
        5.  Спросить: *"Какие помещения арендует компания 'Вектор'?"*. Получить ответ.
    - [ ] **Устранение "костылей":** Вынести настройки (путь к БД, хост LLM) в конфигурационный файл (например, `config.yaml`).
    - [ ] **Создать скрипт запуска:** `run.py`, который активирует окружение, проверяет доступность БД и LLM, и запускает GUI.
    - [ ] **Документировать:** Создать простой `README.md` с инструкцией по установке зависимостей, настройке БД, запуску модели и приложения.

### **Что НЕ входит в MVP (оставляем на Phase 2):**
1.  Telegram-бот.
2.  Микросервисная архитектура (делаем монолит для скорости).
3.  Сложная система прав доступа (один пользователь - админ).
4.  Кэширование (Redis).
5.  История изменений статусов (аудит-лог).
6.  Генерация отчетов в PDF.
7.  Автоматическое распознавание намерения для действий (пока только запросы данных).

---

### **График (Ориентировочный)**
*   **Неделя 1:** Этап 0 + Этап 1 (работающая БД с данными).
*   **Неделя 2:** Этап 2 (работающий ИИ, который по вопросу генерирует SQL и отвечает). **Самая рискованная часть.**
*   **Неделя 3:** Этап 3 (рабочий интерфейс с древом, деталями и чатом).
*   **Неделя 4:** Этап 4 (интеграция, полировка, тестирование).

**Критерий успеха MVP:** Вы, как заказчик, можете запустить приложение, щелкнуть по зданию, увидеть датчики и спросить у ИИ в чате: *"Сколько всего датчиков в здании 'Бета'?"* и получить верный, сформулированный ответ. Это будет означать, что все ключевые компоненты связаны и работают.
